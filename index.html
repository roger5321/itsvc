<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è³‡è¨Šè¨­å‚™å ±ä¿®ç³»çµ±</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { background-color: #f8f9fa; padding-top: 20px; }
        .container { max-width: 800px; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        .loading { display: none; }
    </style>
</head>
<body>

<div class="container">
    <ul class="nav nav-tabs mb-4" id="myTab" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="form-tab" data-bs-toggle="tab" data-bs-target="#form-pane" type="button">ğŸ“ æˆ‘è¦å ±ä¿®</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="stats-tab" data-bs-toggle="tab" data-bs-target="#stats-pane" type="button" onclick="loadStats()">ğŸ“Š å¾Œå°çµ±è¨ˆ</button>
        </li>
    </ul>

    <div class="tab-content">
        <div class="tab-pane fade show active" id="form-pane">
            <h2 class="text-center mb-4">è³‡è¨Šå ±ä¿®å–®</h2>
            <form id="repairForm">
                <div class="mb-3">
                    <label class="form-label">å§“å</label>
                    <input type="text" class="form-control" name="name" required>
                </div>
                <div class="mb-3">
                    <label class="form-label">éƒ¨é–€</label>
                    <select class="form-select" name="dept">
                        <option value="æ¥­å‹™éƒ¨">æ¥­å‹™è™•</option>
                        <option value="ç ”ç™¼éƒ¨">ç”¢å“è™•</option>
						<option value="æ¥­å‹™éƒ¨">å“ä¿éƒ¨</option>
						<option value="æ¥­å‹™éƒ¨">ç¨½æ ¸å®¤</option>
                        <option value="è¡Œæ”¿éƒ¨">ç®¡ç†è™•</option>
						<option value="ç”Ÿç”¢éƒ¨">å®‰è¡›è™•</option>
                        <option value="ç”Ÿç”¢éƒ¨">è³‡æè™•</option>
						<option value="ç”Ÿç”¢éƒ¨">è²¡å‹™è™•</option>
						<option value="ç”Ÿç”¢éƒ¨">å®¢æœè™•</option>
						<option value="ç”Ÿç”¢éƒ¨">ç¸½ç¶“ç†å®¤</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label class="form-label">å•é¡Œé¡å‹</label>
                    <select class="form-select" name="type">
                        <option value="é›»è…¦ç¡¬é«”">é›»è…¦ç¡¬é«” (ç„¡æ³•é–‹æ©Ÿã€è—åº•ç™½å­—)</option>
                        <option value="ç¶²è·¯é€£ç·š">ç¶²è·¯é€£ç·š (ç„¡æ³•ä¸Šç¶²ã€Wi-Fi)</option>
                        <option value="è»Ÿé«”ç³»çµ±">è»Ÿé«”ç³»çµ± (Office, ERP, Mail)</option>
                        <option value="å°è¡¨æ©Ÿ">å°è¡¨æ©Ÿ/äº‹å‹™æ©Ÿ</option>
                        <option value="å…¶ä»–">å…¶ä»–</option>
                    </select>
                </div>

                <div class="mb-3">
                    <label class="form-label">å•é¡Œæè¿°</label>
                    <textarea class="form-control" name="desc" rows="3" required></textarea>
                </div>
				<div class="mb-3">
					<label class="form-label">å§“å</label>
					<input type="text" class="form-control" name="name" required>
				</div>

				<div class="mb-3">
					<label class="form-label">Email (é¸å¡«ï¼Œç”¨æ–¼æ¥æ”¶è™•ç†é€²åº¦)</label>
					<input type="email" class="form-control" name="email" placeholder="name@company.com">
				</div>
                <button type="submit" class="btn btn-primary w-100">æäº¤å ±ä¿®</button>
            </form>
            <div id="msg" class="alert mt-3" style="display:none;"></div>
        </div>

        <div class="tab-pane fade" id="stats-pane">
            <h2 class="text-center mb-4">å ±ä¿®é¡å‹çµ±è¨ˆ</h2>
            <div style="height: 400px;">
                <canvas id="myChart"></canvas>
            </div>
            <div class="text-center mt-3">
                <button class="btn btn-secondary btn-sm" onclick="loadStats()">é‡æ–°æ•´ç†æ•¸æ“š</button>
                <a href="#" id="sheetLink" target="_blank" class="btn btn-success btn-sm">å‰å¾€ Google Sheets ç®¡ç†è³‡æ–™</a>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // â˜…â˜…â˜… è«‹å°‡ä¸‹æ–¹çš„ URL æ›¿æ›æˆä½ éƒ¨ç½² Google Apps Script å¾Œå–å¾—çš„ Web App URL â˜…â˜…â˜…
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwCEF-H5RBX3nhJuWTAIapYInLIiU6GxVIfVcMbdWcI6fTQY5wO-BDb9XOul1NY5PEo/exec';
    
    // è¨­å®š Google Sheet é€£çµä¾›ç®¡ç†å“¡ä½¿ç”¨
    document.getElementById('sheetLink').href = "https://docs.google.com/spreadsheets/d/bHjccpTMzZr5C5leOeynmpflvVNZ2FwUzWH2QrfV3LU";

    // 1. è™•ç†è¡¨å–®æäº¤
    const form = document.getElementById('repairForm');
    const msg = document.getElementById('msg');

    form.addEventListener('submit', e => {
        e.preventDefault();
        msg.style.display = 'block';
        msg.className = 'alert alert-info';
        msg.innerText = 'è³‡æ–™å‚³é€ä¸­...';
        
        const formData = new FormData(form);
        const data = Object.fromEntries(formData);

        fetch(SCRIPT_URL, {
            method: 'POST',
            body: JSON.stringify(data),
            mode: 'no-cors' // Google Script è·¨åŸŸé™åˆ¶ï¼Œä½¿ç”¨ no-cors
        })
        .then(() => {
            msg.className = 'alert alert-success';
            msg.innerText = 'å ±ä¿®æˆåŠŸï¼è³‡è¨Šäººå“¡å°‡ç›¡å¿«è™•ç†ã€‚';
            form.reset();
        })
        .catch(error => {
            msg.className = 'alert alert-danger';
            msg.innerText = 'ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚';
            console.error('Error:', error);
        });
    });

    // 2. è¼‰å…¥çµ±è¨ˆæ•¸æ“š
    let myChart = null;

    function loadStats() {
        fetch(SCRIPT_URL)
        .then(response => response.json())
        .then(data => {
            if(data.result === 'success') {
                renderChart(data.stats);
            }
        });
    }

    function renderChart(stats) {
        const ctx = document.getElementById('myChart');
        const labels = Object.keys(stats);
        const values = Object.values(stats);

        if (myChart) {
            myChart.destroy();
        }

        myChart = new Chart(ctx, {
            type: 'bar', // æˆ– 'pie' åœ“é¤…åœ–
            data: {
                labels: labels,
                datasets: [{
                    label: 'å ±ä¿®ä»¶æ•¸',
                    data: values,
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.2)',
                        'rgba(54, 162, 235, 0.2)',
                        'rgba(255, 206, 86, 0.2)',
                        'rgba(75, 192, 192, 0.2)',
                        'rgba(153, 102, 255, 0.2)'
                    ],
                    borderColor: [
                        'rgba(255, 99, 132, 1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 206, 86, 1)',
                        'rgba(75, 192, 192, 1)',
                        'rgba(153, 102, 255, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: { beginAtZero: true, ticks: { stepSize: 1 } }
                }
            }
        });
    }
</script>

</body>
</html>